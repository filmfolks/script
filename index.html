<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FreeWriter ‚Äî Fountain live preview</title>

<!-- Fountain parser -->
<script src="https://github.com/free-writer/freewriter/blob/main/fountain.min.js"></script>

<!-- Fountain demo stylesheet for screenplay look -->
<link rel="stylesheet" href="https://github.com/free-writer/freewriter/blob/main/styles.css">

<style>
  body {
    margin: 0;
    display: flex;
    height: 100vh;
    background: #111;
    color: #eee;
    font-family: sans-serif;
  }
  #editor {
    flex: 1;
    padding: 1em;
    font-size: 14px;
    font-family: monospace;
    background: #222;
    color: #eee;
    border: none;
    resize: none;
    outline: none;
  }
  #preview {
    flex: 1;
    padding: 1em;
    overflow: auto;
    background: #181818;
  }
  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 40px;
    background: #000;
    display: flex;
    align-items: center;
    padding: 0 1em;
    gap: 10px;
    font-size: 14px;
  }
  header button {
    background: #333;
    color: #eee;
    border: none;
    padding: 4px 8px;
    cursor: pointer;
  }
  header button:hover {
    background: #444;
  }
  #container {
    display: flex;
    flex: 1;
    margin-top: 40px;
  }
</style>
</head>
<body>

<header>
  <span>üìù FreeWriter</span>
  <button id="downloadBtn">Download .fountain</button>
  <button id="clearBtn">Clear</button>
  <span style="margin-left:auto;">Autosave: on</span>
</header>

<div id="container">
  <textarea id="editor" placeholder="Write Fountain here..."></textarea>
  <div id="preview">Preview will appear here.</div>
</div>

<script>
const editor = document.getElementById('editor');
const preview = document.getElementById('preview');
const downloadBtn = document.getElementById('downloadBtn');
const clearBtn = document.getElementById('clearBtn');
const STORAGE_KEY = 'freewriter:fountain';

function renderFountain(text) {
  if (window.fountain && typeof fountain.parse === 'function') {
    const result = fountain.parse(text || '');
    return result.html && result.html.script ? result.html.script : '';
  }
  const esc = (text || '').replace(/&/g,'&amp;').replace(/</g,'&lt;');
  return '<pre>' + esc + '</pre>';
}

function updatePreview() {
  preview.innerHTML = renderFountain(editor.value);
}

editor.addEventListener('input', () => {
  updatePreview();
  localStorage.setItem(STORAGE_KEY, editor.value);
});

// Load saved text
const saved = localStorage.getItem(STORAGE_KEY);
if (saved) editor.value = saved;

// Initial sample text if empty
if (!editor.value.trim()) {
  editor.value = `INT. HOUSE - DAY

A small, cluttered room. A person sits at a desk, typing.

SAM
  (to herself)
  This is a quick sample.

CUT TO:

EXT. STREET - NIGHT

Cars pass by.
`;
}

updatePreview();

// Download button
downloadBtn.addEventListener('click', () => {
  const blob = new Blob([editor.value], {type: 'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'script.fountain';
  a.click();
  URL.revokeObjectURL(a.href);
});

// Clear button
clearBtn.addEventListener('click', () => {
  if (!confirm('Clear the editor?')) return;
  editor.value = '';
  updatePreview();
  localStorage.removeItem(STORAGE_KEY);
});
</script>

</body>
</html>
