<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FILM FOLKS SCREENPLAY WRITER</title>
    <style>
        :root {
            --bg-color: #fff;
            --text-color: #000;
            --border-color: #ccc;
            --preview-bg: #f0f0f0;
            --font-size: 12pt; /* Default font size for zoom */
        }
        body.dark-mode {
            --bg-color: #1e1e1e;
            --text-color: #ddd;
            --border-color: #444;
            --preview-bg: #2a2a2a;
        }
        body { 
            font-family: 'Courier New', monospace; 
            display: flex; 
            height: 100vh; 
            margin: 0; 
            background: var(--bg-color); 
            color: var(--text-color); 
        }
        #editor { flex: 1.2; padding: 20px; border-right: 1px solid var(--border-color); } /* Increased horizontal space */
        #format-buttons { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            width: 50px; 
            padding: 10px; 
            border-right: 1px solid var(--border-color); 
        }
        #format-buttons button { 
            margin: 5px 0; 
            padding: 3px; 
            width: 25px; 
            height: 25px; 
            font-size: 12pt; 
            font-weight: bold; 
            background: var(--bg-color); 
            color: var(--text-color); 
            border: 1px solid var(--border-color); 
            cursor: pointer; 
        }
        #preview { flex: 1; padding: 20px; overflow-y: auto; background: var(--preview-bg); }
        textarea { width: 100%; height: 80%; font-size: var(--font-size); border: 1px solid var(--border-color); resize: none; background: var(--bg-color); color: var(--text-color); } /* Increased vertical size, with zoom variable */
        input { width: calc(100% - 200px); margin-bottom: 10px; padding: 5px; font-size: 12pt; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); display: inline-block; } /* Adjusted width to leave space on right */
        #title-form button, #title-display button { margin-left: 5px; padding: 5px 10px; vertical-align: top; } /* Buttons next to fields */
        button { margin-top: 10px; padding: 3px 6px; margin-right: 5px; font-size: 10pt; } /* Reduced button size */
        .buttons-row { display: flex; align-items: center; flex-wrap: nowrap; } /* Keep buttons in one line */
        .scene-heading { font-weight: bold; text-transform: uppercase; margin: 1em 0; }
        .action { margin: 1em 0; }
        .character { text-transform: uppercase; margin: 2em 0 0 0; text-align: left; width: 60%; margin-left: 20%; }
        .dialogue { margin: 0 0 0 10%; width: 50%; }
        .parenthetical { margin: 0 0 0 15%; width: 45%; font-style: italic; }
        .transition { text-transform: uppercase; text-align: right; margin: 1em 0; }
        .note { font-style: italic; color: #666; margin: 1em 0; } /* Style for notes in preview */
        #output { max-width: 37em; margin: 0 auto; font-size: 12pt; line-height: 1.2; }
        #dark-mode-toggle, #fullscreen-toggle { cursor: pointer; font-size: 16px; background: none; border: none; margin-left: 5px; }
        #exit-fullscreen { display: none; position: absolute; top: 10px; right: 10px; padding: 5px 10px; background: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color); cursor: pointer; }
        body.fullscreen-mode #editor { flex: auto; width: 70%; margin: 0 auto; padding: 10px; } /* Reduced horizontal size, centered */
        body.fullscreen-mode #preview { display: none; }
        body.fullscreen-mode #format-buttons { position: absolute; top: 50%; right: 10px; transform: translateY(-50%); flex-direction: column; width: auto; padding: 0; border: none; background: transparent; } /* Vertical on right side */
        body.fullscreen-mode #format-buttons button { margin: 3px 0; }
        body.fullscreen-mode #exit-fullscreen { display: block; position: absolute; top: 10px; right: 10px; } /* Next to dark mode */
        body.fullscreen-mode textarea { height: calc(95% - 40px); margin-top: 40px; } /* Adjust height and add margin for top bar */
        body.fullscreen-mode #title-form { display: none; }
        body.fullscreen-mode #title-display { display: block; position: absolute; top: 0; left: 0; width: 100%; height: 40px; background: var(--bg-color); border-bottom: 1px solid var(--border-color); text-align: left; padding: 10px; box-sizing: border-box; } /* Top bar for title/writer and buttons */
        body.fullscreen-mode #title-display .controls { display: none; } /* Hide zoom and fullscreen in fullscreen */
        body.fullscreen-mode #title-edit { display: none; } /* Hide Edit Title in fullscreen */
        body.fullscreen-mode .buttons-row { display: none; }
        body.fullscreen-mode #auto-save-toggle { display: none; }
        body.fullscreen-mode #dark-mode-toggle-fs { display: block; position: absolute; top: 10px; right: 50px; font-size: 16px; background: none; border: none; cursor: pointer; } /* Dark mode next to exit in fullscreen */
        #dark-mode-toggle-fs { display: none; }
        #title-display { margin-top: 10px; font-size: 12pt; }
        #title-edit { margin-left: 5px; padding: 5px 10px; vertical-align: top; } /* Edit button close to display text, within editor frame */
        .title-line { display: flex; align-items: center; margin-bottom: 10px; } /* Line for inputs and buttons */
        .controls { display: inline-flex; align-items: center; } /* Controls group */
        #display-title, #display-writer { margin: 0; display: inline-block; }
        #title-display .title-line { justify-content: space-between; } /* Align title/writer and controls */
        #title-display .edit-controls { display: flex; align-items: center; }
        /* Storyboard styles */
        .storyboard-container { max-width: 1200px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px #bbb; padding: 24px; display: none; } /* Hidden by default */
        .top-section { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; position: relative; }
        .top-fields { display: flex; gap: 32px; align-items: center; }
        .top-fields input { font-size: 17px; padding: 6px 9px; border: 1px solid #bbb; border-radius: 4px; width: 230px; }
        .top-label { font-weight: bold; margin-right: 8px; }
        .saved-header { display: none; text-align: center; }
        .saved-title { font-size: 18px; font-weight: bold; letter-spacing: 1px; margin-bottom: 2px; }
        .saved-director, .saved-sequence { font-size: 13px; font-weight: normal; margin-right: 16px; }
        .save-btn { margin-left: 20px; padding: 8px 16px; background: #28a745; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        .save-btn:hover { background: #218838; }
        .edit-btn { display: none; padding: 8px 16px; background: #ffc107; color: #212529; border: none; border-radius: 5px; cursor: pointer; position: absolute; right: 0; }
        .edit-btn:hover { background: #e0a800; }
        .storyboard-row { display: flex; flex-direction: row; gap: 24px; margin-bottom: 32px; }
        .storyboard-panel { width: 220px; background: #f4f4f4; border-radius: 8px; padding: 14px; box-sizing: border-box; flex: 0 0 auto; display: flex; flex-direction: column; align-items: center; }
        .storyboard-thumbnail { width: 190px; height: 120px; background: #ddd; border-radius: 4px; object-fit: cover; margin-bottom: 12px; margin-top: 4px; }
        /* ... (rest of storyboard styles from previous code) */
        /* Print styling for storyboard (from previous code) */
        @media print {
            /* ... (include all @media print styles from previous storyboard code) */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="editor">
        <div id="title-form">
            <div class="title-line">
                <input id="title" placeholder="Screenplay Title">
            </div>
            <div class="title-line">
                <input id="writer" placeholder="Writer Name">
            </div>
            <div class="title-line">
                <button onclick="setTitle()">Save Title</button>
                <div class="controls">
                    <button id="dark-mode-toggle" onclick="toggleDarkMode()">☀️</button>
                    <button onclick="zoomIn()">+</button>
                    <button onclick="zoomOut()">-</button>
                    <button onclick="resetZoom()">R</button>
                    <button id="fullscreen-toggle" onclick="toggleFullscreen()">⛶</button>
                </div>
            </div>
        </div>
        <div id="title-display" style="display: none;">
            <div class="title-line">
                <div>
                    <p id="display-title"></p>
                    <p id="display-writer"></p>
                </div>
                <div class="edit-controls">
                    <button id="title-edit" onclick="editTitle()">Edit Title</button>
                    <div class="controls">
                        <button id="dark-mode-toggle2" onclick="toggleDarkMode()">☀️</button>
                        <button onclick="zoomIn()">+</button>
                        <button onclick="zoomOut()">-</button>
                        <button onclick="resetZoom()">R</button>
                        <button id="fullscreen-toggle2" onclick="toggleFullscreen()">⛶</button>
                    </div>
                </div>
            </div>
        </div>
        <textarea id="input" placeholder="Type Screenplay here... e.g., INT. HOUSE - DAY

SANTHOSH
Hello!"></textarea>
        <div class="buttons-row">
            <button onclick="saveFile()">Save as .fountain</button>
            <button onclick="printPDF()">Print PDF</button>
            <button onclick="previewFullscreen()">Preview Fullscreen</button>
            <button id="auto-save-toggle" onclick="toggleAutoSave()">Auto Save: Off</button>
            <button onclick="toggleStoryboard()">Storyboard</button>
        </div>
    </div>
    <div id="format-buttons">
        <button onclick="applyFormat('S')">S</button>
        <button onclick="applyFormat('A')">A</button>
        <button onclick="applyFormat('C')">C</button>
        <button onclick="applyFormat('D')">D</button>
        <button onclick="applyFormat('P')">P</button>
        <button onclick="applyFormat('T')">T</button>
        <button onclick="applyFormat('G')">G</button>
        <button onclick="applyFormat('N')">N</button>
    </div>
    <div id="preview">
        <h2>Screenplay Preview</h2>
        <div id="output"></div>
    </div>
    <button id="dark-mode-toggle-fs" onclick="toggleDarkMode()">☀️</button>
    <button id="exit-fullscreen" onclick="toggleFullscreen()">□</button>

    <!-- Integrated Storyboard Section -->
    <div class="storyboard-container" id="storyboardSection">
        <div class="top-section">
            <div class="top-fields" id="editFields">
                <span class="top-label">Title:</span>
                <input type="text" id="titleField" placeholder="Storyboard Title">
                <span class="top-label">Director:</span>
                <input type="text" id="directorField" placeholder="Director Name">
                <span class="top-label">Sequence:</span>
                <input type="text" id="sequenceField" placeholder="Sequence">
            </div>
            <div class="saved-header" id="savedHeader">
                <div class="saved-title" id="savedTitle"></div>
                <span class="saved-director" id="savedDirector"></span>
                <span class="saved-sequence" id="savedSequence"></span>
            </div>
            <button class="save-btn" id="saveBtn" onclick="saveHeader()">Save</button>
            <button class="edit-btn" id="editBtn" onclick="editHeader()">Edit</button>
        </div>
        <div id="storyboardRows"></div>
        <button onclick="addPanel()">Add Shot</button>
        <button onclick="window.print()">Print as PDF</button>
        <button onclick="toggleStoryboard()">Back to Screenplay</button>
    </div>

    <script>
        // ... (all existing screenplay script code remains unchanged)

        // Storyboard integration scripts (from previous code)
        let panels = [];
        let panelId = 0;

        function renderStoryboard() {
            const rowsWrap = document.getElementById('storyboardRows');
            rowsWrap.innerHTML = '';
            for(let i=0; i < panels.length; i += 5) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'storyboard-row';
                for(let j=i; j < i+5 && j<panels.length; j++) {
                    rowDiv.appendChild(panels[j]);
                }
                rowsWrap.appendChild(rowDiv);
            }
        }
        
        function addPanel() {
            panelId++;
            const panel = document.createElement('div');
            panel.className = 'storyboard-panel';
            panel.innerHTML = `
                <label class="panel-label">Scene Number</label>
                <input type="text" placeholder="e.g. 1" id="scene${panelId}" oninput="syncPrintLabels(${panelId})">
                <label class="panel-label">Shot Name</label>
                <input type="text" placeholder="e.g. Close Up" id="shot${panelId}" oninput="syncPrintLabels(${panelId})">
                <label class="panel-label">Description</label>
                <textarea rows="2" placeholder="Describe the scene..." id="desc${panelId}" oninput="syncPrintLabels(${panelId})"></textarea>
                <input type="file" accept="image/*" id="img${panelId}" onchange="previewImg(event, ${panelId})">
                <span class="print-shotname" id="printShot${panelId}" style="display:none;"></span>
                <img id="thumb${panelId}" class="storyboard-thumbnail" src="" alt="Thumbnail" style="display:none;">
                <span class="print-description" id="printDesc${panelId}" style="display:none;"></span>
            `;
            panels.push(panel);
            renderStoryboard();
        }

        function toTitleCase(str) {
            return str.replace(/\w\S*/g, function(txt){
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        }

        function toAllCaps(str) {
            return str.toUpperCase();
        }

        window.previewImg = function(event, idx) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const thumb = document.getElementById('thumb'+idx);
                    thumb.style.display = 'block';
                    thumb.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        };

        window.syncPrintLabels = function(idx) {
            const sceneNum = document.getElementById('scene'+idx).value.trim();
            const shot = document.getElementById('shot'+idx).value.trim();
            let combinedShotName = '';
            if(sceneNum && shot){
                combinedShotName = sceneNum + '. ' + toTitleCase(shot);
            } else if(sceneNum) {
                combinedShotName = sceneNum + '.';
            } else if(shot) {
                combinedShotName = toTitleCase(shot);
            }
            document.getElementById('printShot'+idx).textContent = combinedShotName;
            document.getElementById('printDesc'+idx).textContent = toTitleCase(document.getElementById('desc'+idx).value.trim());
        };

        window.saveHeader = function() {
            const title = toAllCaps(document.getElementById('titleField').value.trim());
            const director = "Director: " + toTitleCase(document.getElementById('directorField').value.trim());
            const sequence = "Sequence: " + toTitleCase(document.getElementById('sequenceField').value.trim());

            document.getElementById('savedTitle').textContent = title;
            document.getElementById('savedDirector').textContent = director;
            document.getElementById('savedSequence').textContent = sequence;

            document.getElementById('editFields').style.display = 'none';
            document.getElementById('savedHeader').style.display = 'block';
            document.getElementById('saveBtn').style.display = 'none';
            document.getElementById('editBtn').style.display = 'block';
        };

        window.editHeader = function() {
            document.getElementById('editFields').style.display = 'flex';
            document.getElementById('savedHeader').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('editBtn').style.display = 'none';
        };

        // Toggle storyboard view
        function toggleStoryboard() {
            const editor = document.getElementById('editor');
            const formatButtons = document.getElementById('format-buttons');
            const preview = document.getElementById('preview');
            const storyboard = document.getElementById('storyboardSection');

            if (storyboard.style.display === 'none') {
                editor.style.display = 'none';
                formatButtons.style.display = 'none';
                preview.style.display = 'none';
                storyboard.style.display = 'block';
                // Initialize storyboard if needed
                panels = [];
                panelId = 0;
                for(let i=0;i<5;i++) addPanel();
            } else {
                editor.style.display = 'block';
                formatButtons.style.display = 'flex';
                preview.style.display = 'block';
                storyboard.style.display = 'none';
            }
        }
    </script>
</body>
</html>
