<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Screenplay Writer</title>
  <style>
    :root {
      --bg-color: #fff;
      --text-color: #000;
      --border-color: #ccc;
      --preview-bg: #f0f0f0;
      --font-size: 12pt;
    }
    body.dark-mode {
      --bg-color: #1e1e1e;
      --text-color: #eee;
      --border-color: #444;
      --preview-bg: #2a2a2a;
    }
    body {
      font-family: 'Courier New', monospace;
      display: flex;
      height: 100vh;
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
    }
    #editor { flex: 1.2; padding: 20px; border-right: 1px solid var(--border-color);}
    #preview { flex: 1; padding: 20px; overflow-y: auto; background: var(--preview-bg);}
    textarea {
      width: 100%;
      height: 60vh;
      font-size: var(--font-size);
      border: 1px solid var(--border-color);
      resize: none;
      background: var(--bg-color);
      color: var(--text-color);
      margin-bottom: 10px;
      transition: font-size 0.2s;
    }
    .desktop-toolbar, .buttons-row, #format-buttons { display: flex; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
    .desktop-toolbar input { width: 30%; min-width: 100px; margin-right: 10px; }
    .desktop-toolbar button, .buttons-row button { margin: 2px; padding: 4px 10px; }

    #format-buttons { flex-direction: column; border-right: 1px solid var(--border-color); height: 100%; }
    #format-buttons button { width: 32px; height: 32px; margin-bottom: 6px; font-size: 16px; }

    /* -- Responsive / MOBILE -- */
    @media (max-width: 800px) {
      body { flex-direction: column; }
      #editor, #preview { border-right: none; border-bottom: 1px solid var(--border-color);}
      #editor { padding: 10px; }
      #format-buttons {
        display: none;
      }
      /* Hide desktop toolbar/buttons in mobile-fullscreen */
      #editor.mobile-fullscreen .desktop-toolbar, 
      #editor.mobile-fullscreen .buttons-row {
        display: none !important;
      }
      /* MOBILE FULLSCREEN MODE: Editor expands, top bar appears */
      #editor.mobile-fullscreen {
        position:fixed; z-index:9999;
        left:0; top:0; width:100vw; height:100vh;
        background: var(--bg-color);
        border: none;
        padding: 0;
      }
      #editor.mobile-fullscreen textarea {
        height: calc(100vh - 56px); /* below the mobile bar */
        margin-bottom: 0;
      }
      #mobile-bar {
        display: flex !important;
      }
    }
    /* Top mobile bar for controls - hidden by default */
    #mobile-bar {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0;
      width: 100vw;
      background: var(--bg-color);
      border-bottom: 1.5px solid var(--border-color);
      z-index: 10000;
      justify-content: space-around;
      align-items: center;
      padding: 8px 0;
    }
    #mobile-bar .mobile-btn {
      font-size: 22px;
      padding: 8px 14px;
      background: var(--bg-color);
      border: 2px solid var(--border-color);
      margin: 0 4px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <!-- MOBILE TOP BAR (hidden by default until fullscreen mobile active) -->
  <div id="mobile-bar">
    <button class="mobile-btn" onclick="toggleDarkMode()">☀️</button>
    <button class="mobile-btn" onclick="zoomIn()">+</button>
    <button class="mobile-btn" onclick="zoomOut()">-</button>
    <button class="mobile-btn" onclick="resetZoom()">R</button>
    <button class="mobile-btn" onclick="exitMobileFullscreen()">□</button>
  </div>

  <div id="editor">
    <!-- Desktop toolbar (hidden in mobile fullscreen) -->
    <div class="desktop-toolbar">
      <input id="title" placeholder="Screenplay Title">
      <input id="writer" placeholder="Writer Name">
      <button onclick="toggleDarkMode()">☀️</button>
      <button onclick="zoomIn()">+</button>
      <button onclick="zoomOut()">-</button>
      <button onclick="resetZoom()">R</button>
      <button onclick="enterMobileFullscreen()">⛶</button>
    </div>

    <textarea id="input" placeholder="Type Screenplay here... e.g., INT. HOUSE - DAY

SANTHOSH
Hello!"></textarea>

    <div class="buttons-row">
      <button onclick="saveFile()">Save as .fountain</button>
      <button onclick="printPDF()">Print PDF</button>
    </div>
  </div>
  <!-- Format buttons only on desktop -->
  <div id="format-buttons">
    <button onclick="applyFormat('S')">S</button>
    <button onclick="applyFormat('A')">A</button>
    <button onclick="applyFormat('C')">C</button>
    <button onclick="applyFormat('D')">D</button>
    <button onclick="applyFormat('P')">P</button>
    <button onclick="applyFormat('T')">T</button>
    <button onclick="applyFormat('G')">G</button>
    <button onclick="applyFormat('N')">N</button>
  </div>
  <div id="preview">
    <h2>Screenplay Preview</h2>
    <div id="output"></div>
  </div>
  <script>
    // --- MOBILE AND FULLSCREEN LOGIC ---
    const editor = document.getElementById('editor');
    const textarea = document.getElementById('input');
    const mobileBar = document.getElementById('mobile-bar');
    let currentFontSize = 12;

    function isMobile() {
      return /Mobi|Android|iPhone|iPad|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 800;
    }
    function enterMobileFullscreen() {
      if (isMobile()) {
        editor.classList.add('mobile-fullscreen');
        mobileBar.style.display = 'flex';
        // Focus textarea (bring up keyboard)
        setTimeout(() => { textarea.focus(); }, 200);
      }
    }
    function exitMobileFullscreen() {
      editor.classList.remove('mobile-fullscreen');
      mobileBar.style.display = 'none';
    }

    // --- DARK MODE ---
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? "enabled" : "disabled");
    }
    if (localStorage.getItem('darkMode') === 'enabled') toggleDarkMode();

    // --- ZOOM ---
    function zoomIn() {
      currentFontSize = Math.min(24, currentFontSize + 2);
      textarea.style.fontSize = currentFontSize + 'pt';
    }
    function zoomOut() {
      currentFontSize = Math.max(8, currentFontSize - 2);
      textarea.style.fontSize = currentFontSize + 'pt';
    }
    function resetZoom() {
      currentFontSize = 12;
      textarea.style.fontSize = currentFontSize + 'pt';
    }

    // --- SAVE AND PRINT ---
    function saveFile() {
      const text = textarea.value;
      const blob = new Blob([text], {type: 'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'screenplay.fountain';
      a.click();
    }
    function printPDF() { alert('Print PDF not implemented here, see desktop version.'); }

    // --- FORMAT BUTTONS (not shown in mobile) ---
    function applyFormat(type) {
      // This is a placeholder - adapt as needed
      let val = textarea.value;
      switch(type){
        case 'S': // Scene Heading
          textarea.value = val + '\nINT. ';
          break;
        case 'A': // Action
          textarea.value = val + '\nAction line here';
          break;
        case 'C': // Character
          textarea.value = val + '\nCHARACTER';
          break;
        case 'D': // Dialogue
          textarea.value = val + '\n(dialogue)';
          break;
        case 'P': // Parenthetical
          textarea.value = val + '\n(parenthetical)';
          break;
        case 'T': // Transition
          textarea.value = val + '\nCUT TO:';
          break;
        case 'G':
          textarea.value = val + '\nGeneral text';
          break;
        case 'N':
          textarea.value = val + '\nNotes:- ';
          break;
      }
      textarea.focus();
    }

    // --- SMART CAPITALIZATION ---
    textarea.addEventListener('input', function(e) {
      let lines = textarea.value.split('\n');
      for (let i = 0; i < lines.length; i++) {
        // If line matches scene heading pattern, upper case it
        if (/^\s*(int\.|ext\.|est\.|int\/ext\.|i\/e\.)/.test(lines[i])) {
          lines[i] = lines[i].toUpperCase();
        }
        // If previous line was a scene heading, capitalize only first letter here (Simple action assumption)
        if (
          i > 0 &&
          /^\s*(INT\.|EXT\.|EST\.|INT\/EXT\.|I\/E\.)/.test(lines[i-1].trim()) &&
          (!/^\s*(INT\.|EXT\.|EST\.|INT\/EXT\.|I\/E\.)/.test(lines[i].trim()))
        ) {
          if (lines[i].length > 0)
            lines[i] = lines[i].charAt(0).toUpperCase() + lines[i].slice(1).toLowerCase();
        }
      }
      let pos = textarea.selectionStart;
      textarea.value = lines.join('\n');
      textarea.selectionStart = textarea.selectionEnd = pos;
    });

    // --- OPTIONAL: Dismiss mobile bar if resized to desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth > 800) exitMobileFullscreen();
    });

    // --- Hide mobile bar by default if not on mobile ---
    if (!isMobile()) mobileBar.style.display = 'none';

    // --- Basic live preview (OPTIONAL) ---
    const output = document.getElementById('output');
    textarea.addEventListener('input', updatePreview);
    function updatePreview() {
      output.textContent = textarea.value;
    }
    updatePreview();
  </script>
</body>
</html>
